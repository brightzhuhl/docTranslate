# ZooKeeper开发者向导 #
## 使用ZooKeeper开发分布式应用 ##

- 简介
- ZooKeeper数据模型
	- Znodes
		- Watches
		- 数据访问
		- 临时节点
		- 顺序节点--唯一命名
	- ZooKeeper时间
	- ZooKeeper静态结构
- ZooKeeper Session
- ZooKeeper Watches
- 使用ACLs实现ZooKeeper访问控制
- 可扩展的ZooKeeper鉴权
- 一致性保证
- Binding
- 建立阻塞：ZooKeeper操作指南
- 程序结构，附带例子


----------
**简介**

暂不翻译

**ZooKeeper数据模型**

像很多分布式文件系统一样，ZooKeeper有一个层级命名空间。唯一的不同是：ZooKeeper命名空间中的每一个节点都可以有与之关联的数据，其子节点也是如此。这就像有一个文件系统，它允许文件成为目录。到每一个节点的路径通常表示为规范的用斜线分割的绝对路径；没有相对引用。任何服从以下约束的unicode字符可以在路径中使用：

- 空字符(\u0000)不能作为路径名称的一部分（在C Binding中会有问题）
- 以下字符不能使用，因为他们不能很好地显示或者显示混乱：\u0001 - \u0019，\u007f-\u009f
- 以下字符不允许：\ud800 - \uF8FFF，\uFFF0 - \uFFFF
- “zookeeper”标记为保留字

**ZNodes**

在ZooKeeper树结构中每个节点都指向一个znode。znode维护一个stat结构，这个结构包含了数据变更、acl变更所需的版本号。这个stat结构也包含时间戳。版本号还有时间戳允许ZooKeeper验证缓存并协调更新。每当znode的数据变化，版本号递增。例如，每当client检索数据，它会得到数据的版本号。然后当client执行更新或者删除时，必须提供变更的znode的数据的版本号。如果提供的版本号不匹配当前数据的版本号，更新将会失败（这个行为可以被重写，详细信息参考相关文档）

	注意
	在分布式应用工程中，node标识一般主机、服务器、集群的一个成员、一个客户端进程等。在ZooKeeper文档中，znode标识数据节点。Server标识组成ZooKeeper服务的机器；quorum peers标识组成集群的服务器；client表示使用ZooKeeper服务的任一主机或者进程

znode是程序员需要关注的主要抽象概念，这里提几个值得关注的znode的特性

*监听（Watches）*，client可以在znode设置watches。znode上的变更将触发watch或者清除watch。当watch触发是，ZooKeeper向client发送提醒，更多信息watches相关信息可以参考下面的ZooKeeper Watches章节

*数据访问*，命名空间中的每个znode节点存储的数据都可以原子性地读写的。读操作获取和znode关联的所有字节数据，而写操作也替换掉所有的数据。每个节点有一个访问控制列表（ACL）约束谁可以操作。

ZooKeeper不是设计作为一个通常的数据库或者大型对象存储。相反，它管理协调数据。这些数据可以以配置、状态信息、集合等形式出现。这一系列形式的协调数据的共同性质是他们都相对较小：以kb计。ZooKeeper client和服务器有完整的检查确保znode数据少于1M，但数据平均大小应该远小于这个值。对相对较大的数据的操作将会导致某些操作比其它操作花费更多时间；而且由于通过网络移动数据到存储介质需要额外的时间，会影响到某些操作的延迟。如果需要存储大型数据，通常做法是将这些数据存储到大容量存储系统，例如NFS或HDFS，然后将存储位置的指针存放到ZooKeeper中。

*临时节点*

ZooKeeper也有临时节点概念。这些znode和创建它的Session的活动时间一样长。当Session结束时这些znode也被删除。由于这个行为，znode节点不允许有子节点。

*顺序节点 -- 唯一命名*

当创建一个znode节点时，你可以请求ZooKeeper追加一个单调递增的计数器到路径的末尾。这个计数器对于父节点是唯一的。这个计数器的格式为：%010d -- 也就是带0填充的10位数字（计数器以这种方式格式化以简化排序），即“<path>0000000001”,注意：用于存储下一个序列号的计数器是由父节点维护的有符号int类型，当自增超过2147483647 时计数器将会溢出



